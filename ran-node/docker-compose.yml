version: "3.8"

services:
  gnb:
    build:
      context: .
      dockerfile: Dockerfile.ueransim
    container_name: ran-gnb
    command: ["nr-gnb", "-c", "/config/gnb.yaml"]
    volumes:
      - ./configs/gnb.yaml:/config/gnb.yaml
    networks:
      5gnet:
        ipv4_address: 172.18.0.20
      rannet:
        ipv4_address: 172.20.0.20
    privileged: true

  ue:
    build:
      context: .
      dockerfile: Dockerfile.ueransim
    container_name: ran-ue
    command: ["nr-ue", "-c", "/config/ue.yaml"]
    volumes:
      - ./configs/ue.yaml:/config/ue.yaml
    networks:
      # - 5gnet
      - rannet
    privileged: true
    depends_on:
      - gnb

  ran-ui:
    build:
      context: .
      dockerfile: Dockerfile.ran-ui
    container_name: ran-ui
    volumes:
      - ./configs:/configs
      - /var/run/docker.sock:/var/run/docker.sock
    ports:
      - "0.0.0.0:7777:7777"
    networks:
      - 5gnet
      - rannet
    environment:
      - PORT=7777
      - MONGO_URI=mongodb://o5gs-mongo/open5gs
      # CONFIG_HOST_DIR : PC 마다 다르게 설정
      # - CONFIG_HOST_DIR=/home/givensik/Core-Testbed/ran-node/configs 
      - CONFIG_HOST_DIR=/root/5G-lab/ran-node/configs
      - CONFIG_MOUNT_DIR=/configs
      # - RAN_NETWORK=core-node_5gnet
      - RAN_NETWORK=ran-node_rannet
      - UERANSIM_IMAGE=ran-node-ue


networks:
  5gnet:
    external: true
    name: core-node_5gnet
  rannet:
    driver: bridge
    name: ran-node_rannet
    ipam:
      config:
        - subnet: 172.20.0.0/16
          gateway: 172.20.0.1